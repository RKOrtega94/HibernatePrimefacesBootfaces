<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">
    <b:container>
        <p:panel header="Toma de pedido">
            <center>
                <p:outputLabel for="txtMenu"
                               value="Menu"/>
                <p:spacer width="5"/>
                <p:selectOneMenu id="txtMenu"
                                 value="#{tomaPedidoViewController.menuId}"
                                 effect="fade"
                                 filter="true"
                                 filterMatchMode="startsWith"
                                 panelStyle="width:180px"
                                 style="width: 15em">
                    <f:selectItems value="#{menuController.menus}"
                                   var="item"
                                   itemLabel="#{item.menuNombre}"
                                   itemValue="#{item.menuId}"/>
                </p:selectOneMenu>
                <p:spacer width="5"/>
                <p:outputLabel for="txtCantidad"
                               value="Cantidad"/>
                <p:spacer width="5"/>
                <p:inputText id="txtCantidad"
                             value="#{tomaPedidoViewController.cantidad}"
                             style="width: 5em">
                    <p:keyFilter regEx="/[\d]/"/>
                </p:inputText>
                <p:spacer width="5"/>
                <b:commandButton id="btnAdd"
                                 look="success"
                                 value="Agregar"
                                 iconAwesome="fa-plus"
                                 actionListener="#{tomaPedidoViewController.addPedido()}"
                                 update="dataTable, :growl"/>
            </center>
            <p:separator/>

            <!--Data table-->
            <p:dataTable id="dataTable"
                         widgetVar="data"
                         value="#{tomaPedidoViewController.pedidos}"
                         var="item"
                         editable="true"
                         editMode="cell">
                <f:facet name="header">
                    Pedido
                </f:facet>

                <p:column headerText="Menu">
                    <h:outputText value="#{item.menu.menuNombre}"/>
                </p:column>
                <p:column headerText="Valor unitario">
                    $<h:outputText value="#{item.menu.menuValor}">
                        <f:convertNumber pattern="#0.00"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Cantidad">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{item.cantidad}"/>
                        </f:facet>
                        <f:facet name="input">
                            <h:inputText value="#{item.cantidad}"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column headerText="Total">
                    $<h:outputText value="#{item.menu.menuValor * item.cantidad}">
                        <f:convertNumber pattern="#0.00"/>
                    </h:outputText>
                </p:column>
                <f:facet name="footer">
                    Subtotal:
                    $<h:outputText value="#{tomaPedidoViewController.subtotal}">
                        <f:convertNumber pattern="#0.00"/>
                    </h:outputText>
                </f:facet>
            </p:dataTable>
            <p:contextMenu for="dataTable" widgetVar="cMenu">   
                <p:menuitem value="Edit Cell" icon="pi pi-search" onclick="PF('cellCars').showCellEditor();return false;"/>  
                <p:menuitem value="Hide Menu" icon="pi pi-times" onclick="PF('cMenu').hide()"/>  
            </p:contextMenu> 
        </p:panel>
        <b:commandButton id="btnSave"
                         value="Guardar"
                         look="success"
                         actionListener="#{tomaPedidoViewController.save()}"
                         iconAwesome="fa-floppy-o"/>
    </b:container>
</ui:composition>